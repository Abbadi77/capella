<!--
 Copyright (c) 2006, 2015 THALES GLOBAL SERVICES.
 All rights reserved. This program and the accompanying materials
 are made available under the terms of the Eclipse Public License v1.0
 which accompanies this distribution, and is available at
 http://www.eclipse.org/legal/epl-v10.html
 
 Contributors:
 	Thales - initial API and implementation
-->
<!--?xml version='1.0' encoding='utf-8' ?--><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head> 
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
  <link rel="stylesheet" type="text/css" href="PLUGINS_ROOT/org.polarsys.capella.doc/html/styles.css" media="all" />
 </head> 
 <body> 
  <h1 id="The_DiffMerge_tool">The DiffMerge tool</h1> 
  <h2 id="Overview">Overview</h2> 
  <p>When working with a SCM (Source Control Management) system such as ClearCase, models may exist in different versions. Comparing and merging different versions of a model is thus a crucial activity. It should be possible to compare a model with a previous version in history or, for effective team working, to compare modifications made by several people and merge them in order to obtain a proper integrated version of the model under work.</p> 
  <h2 id="Starting_the_Capella_Diff.2FMerge_Tool">Starting the Capella Diff/Merge Tool</h2> 
  <p>Capella provides a diff/merge tool for models that supports comparison between models, visualization of the differences and selective merge (acceptance/refusal) of those differences.</p> 
  <p>The diff/merge tool is accessible via the ‘Compare With’  ‘Each Other as models’ popup menu item in Capella. This menu item is enabled when two model resources are selected in the Project Explorer (e.g., *.melodymodeller files) as illustrated in the figure below.</p> 
  <p> <img height="503" width="465" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m42c302d5.png" /> </p> 
  <p>The tool can also be used on diagrams (*.aird files as in figure below), model or diagram fragments (*.melodyfragment files, *.airdfragment files) or catalogs of modeling patterns (*.patterns files).</p> 
  <p> <img height="541" width="450" border="0" src="Images/21.1.%20Model%20DiffMerge_html_bf0aba3.png" /> </p> 
  <p>Whenever the menu item is clicked, the comparison of the selected files is proposed:</p> 
  <p> <img height="335" width="463" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m4bef3dd1.png" /> </p> 
  <p>The “ <b>up-and-down-arrows</b>” button on the right can be used to swap the position of models – left or right – in the tool, for convenience. </p> 
  <p>The “ <b>Modifiable</b>” check boxes allow defining which model(s) can be modified. If a check box is unselected, it will not be possible to carry out merge actions which would modify the corresponding model. This is a way to protect a model against accidental changes due to a wrong usage of the tool. </p> 
  <p>The “ <b>Reference</b>” radio buttons specify which model should be considered as the reference model, that is, the model of which the other model is an evolution. This does not alter the way models are compared, only the way differences are represented. Setting a value which is not “None” is equivalent to running a three-way comparison (see below) where the ancestor is the model on the selected side. More precisely: </p> 
  <ul> 
   <li>If “None” is selected then elements which are present in one model and not in the other will always be represented as additions.</li> 
   <li>If “Left” is selected then: 
    <ul> 
     <li>Elements which are present in the left model and not in the right model will be represented as deletions in the right model.</li> 
     <li>Elements which are present in the right model and not in the left model will be represented as additions in the right model.</li> 
    </ul> </li> 
  </ul> 
  <p>*</p> 
  <ul> 
   <li>If “Right” is selected then the result is symmetric to “Left”.</li> 
  </ul> 
  <p>The “ <b>Comparison method</b>” combo box allows selecting the way models are compared. By default, only the standard Capella method for version control is available. Other methods can be added via add-ons to the diff/merge tool. </p> 
  <p>If the user selects three files, the comparison proposes to compare two files taking into account a third common ancestor as illustrated below.</p> 
  <p> <img height="337" width="463" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m260feba7.png" /> </p> 
  <p> <br /> <br /> </p> 
  <p>The “Configure…” button makes it possible to slightly change the result of the comparison. When clicked, the dialog below pops up.</p> 
  <p> <img height="213" width="490" border="0" src="Images/21.1.%20Model%20DiffMerge_html_45465200.png" /> </p> 
  <p> <br /> <br /> </p> 
  <ul> 
   <li>“Keep match IDs” activates tooltips that display the identifiers (IDs) used to match model elements, as shown in the snapshot below. Representing this piece of information in a tooltip allows for a better understanding of how elements have been matched, at the price of a higher memory consumption. <br /> </li> 
  </ul> 
  <p>Note that two model elements match if and only if they have the same “match ID”, which by default refers to their ID property visible in the Properties view.</p> 
  <p> <img height="222" width="487" border="0" src="Images/21.1.%20Model%20DiffMerge_html_29d2b86f.png" /> </p> 
  <p> <br /> <br /> </p> 
  <ul> 
   <li>“Ignore orders” disables the detection of ordering differences, which has the advantage of increasing performance. If selected, then for example the fact that a class contains attributes A, B (B below A) in a model and attributes B, A (A below B) in the other model will yield no difference. <br /> </li> 
  </ul> 
  <p> <b>Warning</b>: This option prevents merging sequence diagrams since they heavily rely on orders, do not select this option for that usage. </p> 
  <p>Once the “Finish” button has been clicked, a few additional information dialogs may pop up.</p> 
  <ul> 
   <li>An “ <b>ambiguous mapping</b>” warning message (figure below). This message pops up if at least one of the models being compared contains duplicate match IDs. It means, if no particular customisation of the diff/merge tool has been made, that each of the duplicates that appears in the dialog is an ID that several elements of the same model have in common. In other words, the model is not correct and violates elementary validation rules. A consequence, as indicated in the dialog, is that there is no guarantee that the comparison is correct or that merge operations will not break the model. </li> 
  </ul> 
  <p> <img height="216" width="532" border="0" src="Images/21.1.%20Model%20DiffMerge_html_39002cd3.png" /> </p> 
  <p> <b>Warning</b>: <b>Do not start a merge activity</b> if this message appears; fix the model(s) first. For that purpose, it may be helpful to select the duplicate IDs in the dialog, right-click, then select a “Copy to clipboard” menu item. This stores the list of duplicate IDs in the clipboard of the operating system. </p> 
  <p>The “ambiguous mapping” message can be shown again at any time after the comparison has been displayed. It is accessible via the “Show inconsistencies” button which is otherwise disabled (red circle in figure below).</p> 
  <p> <img height="97" width="604" border="0" src="Images/21.1.%20Model%20DiffMerge_html_13763f84.png" /> </p> 
  <p> <br /> <br /> </p> 
  <ul> 
   <li>A “ <b>no undo/redo</b>” warning message (figure below). This message pops up when a comparison is being made on *.AIRD files that are already open. The strategy of the tool is to try and minimise the memory usage by comparing the models in memory. This is also true if only one of the *.AIRD files is open: the comparison will operate on the model in memory. In the case of two open models, however, undo/redo cannot be enabled for technical reasons (undo/redo requires that both models are loaded in the same “memory space”). </li> 
  </ul> 
  <p> <img height="185" width="522" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m43da5a9d.png" /> </p> 
  <p>As indicated in the message, if the purpose of the comparison is to merge models, not just to compare them, and undo/redo is required, then it is necessary to close at least one of the models before starting the diff/merge tool to regain the undo/redo capability.</p> 
  <p> <br /> <br /> </p> 
  <h2 id="Configuration_and_Features_of_the_Diff.2FMerge_Tool">Configuration and Features of the Diff/Merge Tool</h2> 
  <h3 id="SVN_preferences">SVN preferences</h3> 
  <p>This subsection is only for users who have models under SVN control.</p> 
  <p>A new preference entry has been added in the SVN preferences named <b>‘Diff Merge for Melody’</b> </p> 
  <p> <br /> <br /> </p> 
  <p> <img height="352" width="604" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m3e423a6f.png" /> </p> 
  <p> <br /> <br /> </p> 
  <p>Select the CapellaDiffMerge.exe file on the file system. Then choose <b>‘Apply’</b>. </p> 
  <p> <br /> </p> 
  <p> <br /> <br /> </p> 
  <p>The SVN Merge category shall be updated:</p> 
  <p> <br /> <br /> </p> 
  <p> <img height="333" width="604" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m241953bf.png" /> </p> 
  <p> <br /> <br /> </p> 
  <p> <img height="40" width="37" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m38d61362.jpg" /> <br /> <br /> </p> 
  <p>The fields “Diff program arguments” and “Merge program arguments” have to be filled manually for each file extension (“aird”, “airdfragment”, “melodyfragment”, “melodymodeller” and “pattern”):</p> 
  <ul> 
   <li>Diff program arguments: -svn -base &quot;${base}&quot; -local &quot;${mine}&quot; -repo &quot;${theirs}&quot;</li> 
   <li>Merge program arguments: -svn -base “${base}&quot; -local &quot;${mine}&quot; -repo &quot;${theirs}&quot; -merge -out &quot;${merged}&quot;</li> 
  </ul> 
  <p> <br /> <br /> </p> 
  <p> <img height="259" width="433" border="0" src="Images/21.1.%20Model%20DiffMerge_html_4e8b8361.png" /> </p> 
  <p> <br /> <br /> </p> 
  <p> <br /> <br /> </p> 
  <h3 id="User_interface_of_the_Diff.2FMerge_Tool">User interface of the Diff/Merge Tool</h3> 
  <p>When started, the diff/merge tool displays a progress dialog. Computing the differences between models takes time according to the size of the models and the number of differences between them. Click the “Run in background” button in order to keep working with Capella while the differences are being computed in parallel.</p> 
  <p> <img height="176" width="376" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m37e3e9e3.png" /> </p> 
  <p>This phase ends with the opening of an editor. The editor presents the differences which have been computed.</p> 
  <p> <img height="361" width="604" border="0" src="Images/21.1.%20Model%20DiffMerge_html_69cae476.png" /> </p> 
  <p>The editor is composed of 2 horizontal sections and 3 vertical sections.</p> 
  <p> <b>Vertical sections</b> </p> 
  <p> <img height="425" width="618" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m4b50cf8c.png" /> </p> 
  <p> <br /> <br /> </p> 
  <p>The middle section represents the contents of the left model while the section on the right-hand side represents the contents of the right model. When hovering on the top of any section, the complete path to the model is displayed as a tooltip if the window is too narrow.</p> 
  <p> <img height="64" width="466" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m1961c198.png" /> </p> 
  <p>In addition, each side is associated to a colour: by default, dark red for the left model and blue for the right model. This colour code is also used in other dialogs of the diff/merge tool in order to prevent any ambiguity.</p> 
  <p>The section on the left-hand side is the Synthesis section: it represents the differences between the models. According to the colour code, model elements which are present in the right model but not in the left model are written in blue, while they are written in dark red in the opposite case. Elements which are present in both sides but have differences in their attributes or references (“modified elements”) are written in purple. The number of differences they contain is written between parentheses. The 3 sections are synchronised: clicking an element in the Synthesis section highlights it in the other sections and vice-versa.</p> 
  <p> <br /> <br /> </p> 
  <p> <b>Horizontal sections</b> </p> 
  <p> <img height="368" width="625" border="0" src="Images/21.1.%20Model%20DiffMerge_html_ma5d5753.png" /> </p> 
  <p> <br /> <br /> </p> 
  <p>The 2 horizontal sections correspond to 2 levels of detail. The top section focuses on model elements and only reflects that level of granularity. The bottom section is the Details section: it shows the contents (attributes and references) of the model element which is currently selected in the top section.</p> 
  <p>For example, if a modified element (in purple) is being clicked in the Synthesis section, then the Details section displays all the attributes and references of that element that have differences. The corresponding values are displayed in the middle and right parts of the Details section according to the model they belong to. These sub-sections are called the Value sections. For instance, in the snapshot above, element “N2” is selected in the Synthesis section; the Details section shows that it has a difference on its name: the name is “N2” in the left model and “Niveau 2” in the right model as shown in the Value sections.</p> 
  <p> <br /> <br /> </p> 
  <p> <b>Tools: top middle/right-hand sections</b> </p> 
  <p> <img height="19" width="23" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m617a07f2.png" /> The lock button prevents any modification to the corresponding model. Consequently, the merge buttons which are usually enabled will be disabled if they involve a modification in that model. </p> 
  <p> <b>Tools: top left-hand section</b> </p> 
  <p> <img height="23" width="126" border="0" src="Images/21.1.%20Model%20DiffMerge_html_5b88a302.png" /> </p> 
  <p>These buttons are respectively meant to:</p> 
  <ul> 
   <li>Expand the tree of the Synthesis section. Be careful that this operation may take time on large models.</li> 
   <li>Collapse the tree of the Synthesis section.</li> 
   <li>Sort the elements of the Synthesis section alphabetically.</li> 
   <li>Enable/disable the synchronisation between the Synthesis section and the middle and right sections.</li> 
  </ul> 
  <p>Additional features are available via a click on the triangle-shaped button.</p> 
  <p> <img height="243" width="215" border="0" src="Images/21.1.%20Model%20DiffMerge_html_6132844d.png" /> </p> 
  <ul> 
   <li>“Show uncounted elements”: when active, the Synthesis shows all elements of both models, not only those that have differences.</li> 
   <li>“Show moved elements twice”: when an element has a different container in the left and right models, the Synthesis section only shows it in its “left container”. When this menu item is active, however, the element is also represented in its “right container”.</li> 
   <li>“Count additional left elements”: when not active, elements which are present on the left and not on the right are filtered out.</li> 
   <li>“Count additional right elements”: when not active, elements which are present on the right and not on the left are filtered out.</li> 
   <li>“Count moves”: when not active, the fact that elements have different containers in the left and right models is ignored.</li> 
   <li>“Count attributes and references”: when not active, differences on attributes and references within elements are filtered out.</li> 
  </ul> 
  <p>Note that when a filter is active, the “[filtered]” warning appears in the Synthesis view to remind the user that only a subset of the differences is being displayed.</p> 
  <ul> 
   <li>“Use custom icons”: whether the icons of elements are decorated with arrows indicating the origin of the differences.</li> 
   <li>“Use custom labels”: whether the name of elements is enriched with characters indicating the origin of the differences.</li> 
   <li>“Show merge impact”: whether a “merge impact” dialog must be displayed before a merge is being performed. This dialog represents all the changes that are going to be made to the model due to the merge (see snapshot below). It allows the user to better understand the consequences of his merge actions and if needed to cancel them. Those consequences are not always trivial: in order to be merged, certain differences require others to be merged at the same time in order to preserve the integrity of the model – which is done automatically by the diff/merge tool. Those differences appear as “Implied changes” in the dialog. Note that in 3-way comparisons, merging a difference may prevent the merge of another difference in the opposite direction – which is called a conflict. Such conflicts are highlighted by a red overlay icon in the dialog.</li> 
  </ul> 
  <p> <img height="290" width="443" border="0" src="Images/21.1.%20Model%20DiffMerge_html_6a675b42.png" /> </p> 
  <ul> 
   <li>“Support undo/redo”: when active, the user has the possibility to undo/redo his actions via the usual shortcuts &lt;Ctrl-Z&gt; and &lt;Ctrl-Y&gt; or via the “Edit” menu. This feature is more appropriate when the models have a limited size; otherwise, undoing a merge on a large model may be a long-running operation.</li> 
   <li>“Log changes to models”: when active, all modifications made to the models are logged in an HTML file. This file is named “ModelComparisonLog.htm” and is located near the usual “.log” file in the “.metadata” sub-folder of the current workspace folder. If the current workspace folder is unknown, right-click a Melody project that has been created from scratch, click the “Properties” menu item and look for the “Location” line in the “Resource” category.</li> 
  </ul> 
  <p> <b>Important notice</b>: the last 3 features (“show merge impact”, “support undo/redo”, “log changes to models”) have a cost in performance. Merging differences typically takes longer and requires more memory if they are enabled. It may thus be relevant to disable them when performing large merges. Note that undo/redo is the most expensive feature and logging the least expensive. </p> 
  <p> <br /> <br /> </p> 
  <p> <b>Tools: bottom left-hand section</b> </p> 
  <p> <img height="21" width="84" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m7ecf793e.png" /> </p> 
  <p>These buttons support fast navigation to the next/previous element that has differences. Their usage removes the burden of manually unfolding the tree of the Synthesis section and looking for the differences.</p> 
  <p> <br /> <br /> </p> 
  <p>Additional features are available via a click on the triangle-shaped button.</p> 
  <p> <img height="82" width="183" border="0" src="Images/21.1.%20Model%20DiffMerge_html_c86e852.png" /> </p> 
  <ul> 
   <li>“Show values on differences”: when selected, only the values which are different are displayed in the Value sections.</li> 
   <li>“Show all values”: when selected, all the values of the current attribute or reference are shown in the Value sections. Those that are different are highlighted.</li> 
   <li>“’Show all values and features”: when selected, all the features (attributes and references) of the current element are shown in the Details section. The features that have differences are highlighted as in the snapshot below. It is thus possible to see all the contents of a model element, although it is generally advised to use the Melody Semantic Browser view instead.</li> 
  </ul> 
  <p> <img height="126" width="334" border="0" src="Images/21.1.%20Model%20DiffMerge_html_7eb489c7.png" /> </p> 
  <p> <br /> <br /> </p> 
  <p> <b>Tools: bottom middle/right-hand sections</b> </p> 
  <p> <img height="25" width="159" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m47d0d5c1.png" /> </p> 
  <p>Those buttons control how the compared models are being merged. They are grouped into 2 symmetrical groups, one group for each model. The buttons in the groups are automatically enabled and disabled according to the current selection.</p> 
  <ul> 
   <li> <img height="23" width="22" border="0" src="Images/21.1.%20Model%20DiffMerge_html_5b0468f9.png" /> The “Copy to the right/left” buttons: given an element or a value which is present in one model and not in the other, clicking this button copies the element or value and stores it in the model where it is missing. </li> 
   <li> <img height="20" width="21" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m7a3a1b12.png" /> The “Delete on the left/right” buttons: given an element or value which is present in one model and not in the other, clicking this button deletes the element or value in the model where it is present. </li> 
   <li> <img height="21" width="20" border="0" src="Images/21.1.%20Model%20DiffMerge_html_3f155383.png" /> The “Ignore on the left/right” buttons: the selected differences are ignored and will not appear any longer although they are not merged. By clicking this button, the user states that the selected differences are not interesting or relevant. </li> 
  </ul> 
  <p>These buttons can be applied on values when the current selection is in a Value section, or on elements when the current selection is in the Synthesis section. If the selection is multiple or contains several differences, the “Delete” buttons are disabled and the “Copy” buttons allow merging all the differences. Clicking them pops up a dialog which allows the user to state how differences must be merged.</p> 
  <p> <img height="191" width="441" border="0" src="Images/21.1.%20Model%20DiffMerge_html_306f66da.png" /> </p> 
  <ul> 
   <li>The “Include differences in children” check-box determines whether the differences in the selected elements and all their children in the containment tree must be merged. Otherwise, only the differences in the selected elements are merged.</li> 
   <li>The “Incremental mode”, when active, does not delete elements or values. Only the differences that preserve the existing data are merged.</li> 
   <li>“Show merge impact”: overrides the “Show merge impact” option (see description of the corresponding menu item of the Synthesis section) for large merges.</li> 
  </ul> 
  <p>Similarly to the “Copy” buttons, the “Ignore” buttons may trigger a dedicated dialog which allows controlling whether the action is applicable to all children of the selected elements. If the check-box is not ticked, differences on the selected elements are ignored but not differences on their children.</p> 
  <p> <img height="149" width="441" border="0" src="Images/21.1.%20Model%20DiffMerge_html_6268bf2e.png" /> </p> 
  <p> <br /> <br /> </p> 
  <h2 id="The_Capella_Diff.2FMerge_process">The Capella Diff/Merge process</h2> 
  <h3 id="Starting_the_Diff.2FMerge_tool">Starting the Diff/Merge tool</h3> 
  <p>The Diff/Merge tool can be started in Capella using the ‘Compare With’  ‘Each Other as models’ contextual menu on ‘*.melodymodeller’, ‘*.aird’, ‘*.melodyfragment’ or ‘*.patterns’ files.</p> 
  <p> <img height="100" width="301" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m4a2563eb.png" /> </p> 
  <p>Alternatively, the standalone Diff/Merge tool can be called independently. On startup, it requires the selection of the two or three (with ancestor) files to compare.</p> 
  <p> <img height="144" width="222" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m64e99670.png" /> </p> 
  <p> <img height="295" width="365" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m610d0270.png" /> </p> 
  <h3 id="Resolve_differences">Resolve differences</h3> 
  <p>The end-user shall use at least the following tools to resolve differences.</p> 
  <ul> 
   <li> <img height="25" width="48" border="0" src="Images/21.1.%20Model%20DiffMerge_html_6894195c.png" /> Buttons for navigating between differences. </li> 
   <li> <img height="25" width="159" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m47d0d5c1.png" /> Buttons for merging and ignoring differences. </li> 
   <li> <img height="21" width="22" border="0" src="Images/21.1.%20Model%20DiffMerge_html_7d047cd2.png" /> or the &lt;Ctrl-S&gt; shortcut for saving the changes. </li> 
  </ul> 
  <p>The precise meaning and usage of these tools is described in the previous section.</p> 
  <p>Note that in some cases performing a merge can take time, especially if it is a global merge between large models. A progress bar is being displayed during the operation.</p> 
  <p> <img height="188" width="450" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m9cba6ee.png" /> </p> 
  <p> <br /> <br /> </p> 
  <h3 id="Save_for_committing_the_resolution_results">Save for committing the resolution results</h3> 
  <p>Resolution of differences is considered to be finished when the content of the Synthesis section is empty and changes have been saved by pressing &lt;Ctrl-S&gt;.</p> 
  <p> <img height="62" width="427" border="0" src="Images/21.1.%20Model%20DiffMerge_html_m4d91695e.png" /> </p> 
  <p>Note that the absence of visible differences does not mean that the left and right models are identical. It simply means that all differences have been checked by the user and either merged or explicitly ignored.</p> 
  <p> <br /> <br /> </p> 
  <p> <br /> <br /> </p>   
 </body>
</html>
